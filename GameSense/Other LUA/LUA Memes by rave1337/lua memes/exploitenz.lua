local ffi = require("ffi")

ffi.cdef[[
	typedef int(__thiscall* write_file_t)(void*, void const*, int, void*);
	typedef void*(__thiscall* open_file_t)(void*, const char*, const char*, const char*);
	typedef void(__thiscall* close_file_t)(void*, void*);
	typedef bool(__thiscall* unzip_file_t)(void*, const char*, const char*, const char*);
]]

local class_ptr = ffi.typeof("void***")
local rawfilesystem = client.create_interface("filesystem_stdio.dll", "VBaseFileSystem011") or error("error", 2)
local filesystem = ffi.cast(class_ptr, rawfilesystem) or error("error", 2)
local write_file = ffi.cast("write_file_t", filesystem[0][1]) or error("error", 2)
local open_file = ffi.cast("open_file_t", filesystem[0][2]) or error("error", 2)
local close_file = ffi.cast("close_file_t", filesystem[0][3]) or error("error", 2)
local unzip_file = ffi.cast("unzip_file_t", filesystem[0][16]) or error("error", 2)

--local zip = "\x50\x4B\x03\x04\x14\x00\x00\x00\x08\x00\x08\x03\x64\x3C\xF9\xF4\x89\x64\x48\x01\x00\x00\xB8\x01\x00\x00\x07\x00\x00\x00\x72\x2F\x72\x2E\x7A\x69\x70\x00\x25\x00\xDA\xFF\x50\x4B\x03\x04\x14\x00\x00\x00\x08\x00\x08\x03\x64\x3C\xF9\xF4\x89\x64\x48\x01\x00\x00\xB8\x01\x00\x00\x07\x00\x00\x00\x72\x2F\x72\x2E\x7A\x69\x70\x00\x2F\x00\xD0\xFF\x00\x25\x00\xDA\xFF\x50\x4B\x03\x04\x14\x00\x00\x00\x08\x00\x08\x03\x64\x3C\xF9\xF4\x89\x64\x48\x01\x00\x00\xB8\x01\x00\x00\x07\x00\x00\x00\x72\x2F\x72\x2E\x7A\x69\x70\x00\x2F\x00\xD0\xFF\xC2\x54\x8E\x57\x39\x00\x05\x00\xFA\xFF\xC2\x54\x8E\x57\x39\x00\x05\x00\xFA\xFF\x00\x05\x00\xFA\xFF\x00\x14\x00\xEB\xFF\xC2\x54\x8E\x57\x39\x00\x05\x00\xFA\xFF\x00\x05\x00\xFA\xFF\x00\x14\x00\xEB\xFF\x42\x88\x21\xC4\x00\x00\x14\x00\xEB\xFF\x42\x88\x21\xC4\x00\x00\x14\x00\xEB\xFF\x42\x88\x21\xC4\x00\x00\x14\x00\xEB\xFF\x42\x88\x21\xC4\x00\x00\x14\x00\xEB\xFF\x42\x88\x21\xC4\x00\x00\x00\x00\xFF\xFF\x00\x00\x00\xFF\xFF\x00\x34\x00\xCB\xFF\x42\x88\x21\xC4\x00\x00\x00\x00\xFF\xFF\x00\x00\x00\xFF\xFF\x00\x34\x00\xCB\xFF\x42\xE8\x21\x5E\x0F\x00\x00\x00\xFF\xFF\x0A\xF0\x66\x64\x12\x61\xC0\x15\xDC\xE8\xA0\x48\xBF\x48\xAF\x2A\xB3\x20\xC0\x9B\x95\x0D\xC4\x67\x04\x42\x53\x06\x06\x06\x40\x00\x06\x00\xF9\xFF\x6D\x01\x00\x00\x00\x00\x42\xE8\x21\x5E\x0F\x00\x00\x00\xFF\xFF\x0A\xF0\x66\x64\x12\x61\xC0\x15\xDC\xE8\xA0\x48\xBF\x48\xAF\x2A\xB3\x20\xC0\x9B\x95\x0D\xC4\x67\x04\x42\x53\x06\x06\x06\x40\x00\x06\x00\xF9\xFF\x6D\x01\x00\x00\x00\x00\x50\x4B\x01\x02\x14\x00\x14\x00\x00\x00\x08\x00\x08\x03\x64\x3C\xF9\xF4\x89\x64\x48\x01\x00\x00\xB8\x01\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x72\x2F\x72\x2E\x7A\x69\x70\x50\x4B\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00\x35\x00\x00\x00\x6D\x01\x00\x00\x00\x00"
local zip = "\x50\x4B\x03\x04\x0A\x00\x00\x00\x00\x00\xA5\xB4\x27\x51\xAC\x8A\xCE\x46\x07\x00\x00\x00\x07\x00\x00\x00\x05\x00\x00\x00\x61\x2E\x74\x78\x74\x68\x65\x6C\x6C\x6F\x0D\x0A\x50\x4B\x01\x02\x3F\x00\x0A\x00\x00\x00\x00\x00\xA5\xB4\x27\x51\xAC\x8A\xCE\x46\x07\x00\x00\x00\x07\x00\x00\x00\x05\x00\x24\x00\x00\x00\x00\x00\x00\x00\x20\x00\x00\x00\x00\x00\x00\x00\x61\x2E\x74\x78\x74\x0A\x00\x20\x00\x00\x00\x00\x00\x01\x00\x18\x00\xA3\xF6\x95\x18\xA2\x85\xD6\x01\xA3\xF6\x95\x18\xA2\x85\xD6\x01\x09\xB0\xB0\x16\xA2\x85\xD6\x01\x50\x4B\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00\x57\x00\x00\x00\x2A\x00\x00\x00\x00\x00"
local file = open_file(filesystem, "a.zip", "wb", "MOD")
write_file(filesystem, zip, #zip + 1, file)
close_file(filesystem, file)
unzip_file(filesystem, "a.zip", "MOD", "C:\\hello\\")